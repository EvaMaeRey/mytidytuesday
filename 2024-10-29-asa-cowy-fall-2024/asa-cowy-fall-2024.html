<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ASA-COWY, Fall 2024</title>
    <meta charset="utf-8" />
    <meta name="author" content="Evangeline ‘Gina’ Reynolds" />
    <script src="libs/header-attrs-2.26/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/hygge.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/ninjutsu.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# ASA-COWY, Fall 2024
]
.subtitle[
## Everyday ggplot2 extension: New approaches to light-weight ‘geom’ (layer) extension
]
.author[
### Evangeline ‘Gina’ Reynolds
]

---




## Proposal:

Everyday ggplot2 extension: New approaches to light-weight 'geom' (layer) extensions

Creating new layers (geom_* functions) in ggplot2 extension has been described as an 'involved process'.  While new educational material has lowered the conceptual barrier to entry, the amount of scaffolding code required for classical extension can make regularly using extension feel prohibitive.  In this talk, I'll discuss strategies and tools to make experimentation with new functionality more light-weight and fun.  A few practical applications in statistics pedagogy will be presented. 


---

Tell you about:

[Everyday ggplot2 extension](https://evamaerey.github.io/everyday_ggplot2_extension/) initiatives

--

1. Learning resources
    a. [easy recipes]
    b. [cookbook](https://evamaerey.github.io/ggplot2-extension-cookbook/)

--

2. Community - [Extenders club](https://github.com/teunbrand/ggplot-extension-club)

    a. meetup 
    b. club
    c. workshop?

--

3. Light-weight approach to ggplot2 extension...
    
---

## Intro Thoughts



---

count: false
 

.panel1-bump-auto[

``` r
*library(tidyverse)
```
]
 
.panel2-bump-auto[

]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
*library(ggbump)
```
]
 
.panel2-bump-auto[

]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
library(ggbump)

*life_exp_rank_2020
```
]
 
.panel2-bump-auto[

```
## # A tibble: 60 × 7
##    country continent  year lifeExp      pop gdpPercap life_exp_rank
##    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 Canada  Americas   1952    68.8 14785584    11367.             2
##  2 Canada  Americas   1957    70.0 17010154    12490.             2
##  3 Canada  Americas   1962    71.3 18985849    13462.             1
##  4 Canada  Americas   1967    72.1 20819767    16077.             1
##  5 Canada  Americas   1972    72.9 22284500    18971.             1
##  6 Canada  Americas   1977    74.2 23796400    22091.             1
##  7 Canada  Americas   1982    75.8 25201900    22899.             1
##  8 Canada  Americas   1987    76.9 26549700    26627.             1
##  9 Canada  Americas   1992    78.0 28523502    26343.             1
## 10 Canada  Americas   1997    78.6 30305843    28955.             2
## # ℹ 50 more rows
```
]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
library(ggbump)

life_exp_rank_2020 %&gt;%
* ggplot()
```
]
 
.panel2-bump-auto[
![](asa-cowy-fall-2024_files/figure-html/bump_auto_04_output-1.png)&lt;!-- --&gt;
]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
library(ggbump)

life_exp_rank_2020 %&gt;%
  ggplot() +
* aes(x = year,
*     y = life_exp_rank,
*     color = country)
```
]
 
.panel2-bump-auto[
![](asa-cowy-fall-2024_files/figure-html/bump_auto_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
library(ggbump)

life_exp_rank_2020 %&gt;%
  ggplot() +
  aes(x = year,
      y = life_exp_rank,
      color = country) +
* geom_point()
```
]
 
.panel2-bump-auto[
![](asa-cowy-fall-2024_files/figure-html/bump_auto_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
library(ggbump)

life_exp_rank_2020 %&gt;%
  ggplot() +
  aes(x = year,
      y = life_exp_rank,
      color = country) +
  geom_point() +
* scale_y_reverse()
```
]
 
.panel2-bump-auto[
![](asa-cowy-fall-2024_files/figure-html/bump_auto_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 

.panel1-bump-auto[

``` r
library(tidyverse)
library(ggbump)

life_exp_rank_2020 %&gt;%
  ggplot() +
  aes(x = year,
      y = life_exp_rank,
      color = country) +
  geom_point() +
  scale_y_reverse() +
* geom_bump()  #&lt;&lt;
```
]
 
.panel2-bump-auto[
![](asa-cowy-fall-2024_files/figure-html/bump_auto_08_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-bump-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-bump-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-bump-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

# Graphical Poem!!!

--

"The article concludes by discussing some perceptual issues, and thinking about how we can build on the grammar to learn how to create graphical 'poems.'"



``` r
life_exp_rank_2020 %&gt;% 
  ggplot() + 
  aes(x = year, 
      y = life_exp_rank, 
      color = country) + 
  scale_y_reverse() +
  geom_point() + 
  geom_bump()
```

---

# - 'I have two kids, it's so hard to be so deep in ggplot, it takes at least two days just to get all the information in your head again.  So I'm struggling with maintaining [ggbump, ggaluvial, ggsankey]'

---

# - 'I have about 200 kids...'  Univeristy Professor

---

# - 'I have 1000 kids...'  Academy Curriculum Director

---

# - 'I have a thesis to finish'  Graduate Student


---

# 'How to extend ggplot2 while drowning'...?

--

## managing 'care tasks' ...

![](https://m.media-amazon.com/images/I/61DJiOiZeGL._SY445_SX342_QL70_FMwebp_.jpg)


---

## 1. extension is be an analytic 'care task' - can help you in the long run

--

## 2. but in the short run, barriers present a burden

---

# 'How to extend ggplot2 while drowning'...

--

Don't go deep.  

--

Stay intentionally light-weight, and superficial.

--

Swim with friends!  

---

# Specifically...

Check out new educational resources - super accessible recipes and cookbook.

--

'early exits'

--

minimal packaging (no CRAN, minimal messaging testing)

--

no packaginfg - in-script extension

--

new, low code extension. &lt;&lt;

---


Caveat... mostly interested in Stat extension.  Powerful and underutilized for data exploration and statistical education.

--

"... creating new Stats is one of the most useful ways to extend the capabilities of ggplot2." – ggplot2: Elegant Graphics for Data Analysis


---

### Classical layer creation via a Stat ...

--

`geom_support()`  -- What are the logical limits for observed proportions?


```
## # A tibble: 6 × 3
##   Default Choice decision 
##   &lt;chr&gt;   &lt;chr&gt;  &lt;fct&gt;    
## 1 opt-in  donor  donor (1)
## 2 opt-in  donor  donor (1)
## 3 opt-in  donor  donor (1)
## 4 opt-in  donor  donor (1)
## 5 opt-in  donor  donor (1)
## 6 opt-in  donor  donor (1)
```

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;



---

count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
*donor
```
]
 
.panel2-step0-auto[

```
## # A tibble: 161 × 3
##    Default Choice decision 
##    &lt;chr&gt;   &lt;chr&gt;  &lt;fct&gt;    
##  1 opt-in  donor  donor (1)
##  2 opt-in  donor  donor (1)
##  3 opt-in  donor  donor (1)
##  4 opt-in  donor  donor (1)
##  5 opt-in  donor  donor (1)
##  6 opt-in  donor  donor (1)
##  7 opt-in  donor  donor (1)
##  8 opt-in  donor  donor (1)
##  9 opt-in  donor  donor (1)
## 10 opt-in  donor  donor (1)
## # ℹ 151 more rows
```
]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
* summarise(x = min(as.numeric(decision)),
*           xend = max(as.numeric(decision)),
*           y = 0,
*           yend = 0)
```
]
 
.panel2-step0-auto[

```
## # A tibble: 1 × 4
##       x  xend     y  yend
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     0     0
```
]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0,
            yend = 0) -&gt;
*donor_min_max
```
]
 
.panel2-step0-auto[

]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0,
            yend = 0) -&gt;
donor_min_max

*donor
```
]
 
.panel2-step0-auto[

```
## # A tibble: 161 × 3
##    Default Choice decision 
##    &lt;chr&gt;   &lt;chr&gt;  &lt;fct&gt;    
##  1 opt-in  donor  donor (1)
##  2 opt-in  donor  donor (1)
##  3 opt-in  donor  donor (1)
##  4 opt-in  donor  donor (1)
##  5 opt-in  donor  donor (1)
##  6 opt-in  donor  donor (1)
##  7 opt-in  donor  donor (1)
##  8 opt-in  donor  donor (1)
##  9 opt-in  donor  donor (1)
## 10 opt-in  donor  donor (1)
## # ℹ 151 more rows
```
]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0,
            yend = 0) -&gt;
donor_min_max

donor |&gt;
*ggplot()
```
]
 
.panel2-step0-auto[
![](asa-cowy-fall-2024_files/figure-html/step0_auto_05_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0,
            yend = 0) -&gt;
donor_min_max

donor |&gt;
ggplot() +
* aes(x = decision)
```
]
 
.panel2-step0-auto[
![](asa-cowy-fall-2024_files/figure-html/step0_auto_06_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0,
            yend = 0) -&gt;
donor_min_max

donor |&gt;
ggplot() +
  aes(x = decision) +
* geom_bar(width = .2)
```
]
 
.panel2-step0-auto[
![](asa-cowy-fall-2024_files/figure-html/step0_auto_07_output-1.png)&lt;!-- --&gt;
]

---
count: false
 
### Step 0. use base ggplot2, compute before plotting
.panel1-step0-auto[

``` r
donor |&gt;
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0,
            yend = 0) -&gt;
donor_min_max

donor |&gt;
ggplot() +
  aes(x = decision) +
  geom_bar(width = .2) +
* geom_segment(data = donor_min_max,
*              aes(x = x,
*                  xend = xend,
*                  y = 0,
*                  yend = 0))
```
]
 
.panel2-step0-auto[
![](asa-cowy-fall-2024_files/figure-html/step0_auto_08_output-1.png)&lt;!-- --&gt;
]

&lt;style&gt;
.panel1-step0-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-step0-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-step0-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;




``` r
donor |&gt; 
  summarise(x = min(as.numeric(decision)),
            xend = max(as.numeric(decision)),
            y = 0, 
            yend = 0) -&gt;
donor_min_max
  
donor |&gt;
ggplot() + 
  aes(x = decision) +
  geom_bar(width = .2) +
  geom_segment(data = donor_min_max,
               aes(x = x,
                   xend = xend,
                   y = 0, 
                   yend = 0))
```

![](asa-cowy-fall-2024_files/figure-html/step0-1.png)&lt;!-- --&gt;

---

# Step 1. Define Compute



``` r
compute_panel_support &lt;- function(data, scales){
  
  data |&gt;
    summarize(xend = max(x),
              x = min(x),
              yend = 0,
              y = 0)
  
}
```

---

# Step 2. Define Stat



``` r
StatSupport &lt;- ggproto(`_class` = "StatSupport",
                       `_inherit` = ggplot2::Stat,
                       compute_panel = compute_panel_support,
                       required_aes = "x")
```

---

# Step 3. Define user-facing function



``` r
geom_support &lt;- function (mapping = NULL, data = NULL, 
                          geom = "segment", position = "identity", 
                          ..., show.legend = NA, inherit.aes = TRUE) 
{
    layer(data = data, mapping = mapping, stat = StatSupport, 
        geom = geom, position = position, show.legend = show.legend, 
        inherit.aes = inherit.aes, params = rlang::list2(na.rm = FALSE, 
            ...))
}
```

---

# Yippee!!  Such a nice poem!!


``` r
donor |&gt; 
  ggplot() + 
  aes(x = decision) +
  geom_bar(width = .2) + 
* geom_support()
```

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

---


# Style of Everyday ggplot2 extension Recipes and Cookbook

---

# At what cost?  How much code? 

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

---

# At what cost?  How much code? 


![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;

```
##      fill        label group PANEL count cum_n      xmax      xmin        r r0
## 1 #F8766D  18.9%\n(94)     1     1    94    94 0.1891348 0.0000000 12.57776  0
## 2 #00BFC4 81.1%\n(403)     2     1   403   497 1.0000000 0.1891348 12.57776  0
##   ymin     ymax y      prop percent r_prop r_nudge         x   y_text
## 1    0 12.57776 0 0.1891348   18.9%      1       0 0.0945674 12.57776
## 2    0 12.57776 0 0.8108652   81.1%      1       0 0.5945674 12.57776
##   angle_wedge colour linewidth linetype alpha
## 1    55.95573     NA       0.5        1    NA
## 2  -124.04427     NA       0.5        1    NA
```

--- 

# What if you have a much longer graphical poem in mind?

---





![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem-1.png)&lt;!-- --&gt;







count: false


```
## # A tibble: 161 × 3
##    Default Choice decision 
##    &lt;chr&gt;   &lt;chr&gt;  &lt;fct&gt;    
##  1 opt-in  donor  donor (1)
##  2 opt-in  donor  donor (1)
##  3 opt-in  donor  donor (1)
##  4 opt-in  donor  donor (1)
##  5 opt-in  donor  donor (1)
##  6 opt-in  donor  donor (1)
##  7 opt-in  donor  donor (1)
##  8 opt-in  donor  donor (1)
##  9 opt-in  donor  donor (1)
## 10 opt-in  donor  donor (1)
## # ℹ 151 more rows
```

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_02_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_03_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_04_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_05_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_06_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_07_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_08_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_09_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_10_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_11_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_12_output-1.png)&lt;!-- --&gt;

---
count: false

![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_13_output-1.png)&lt;!-- --&gt;

&lt;style&gt;
.panel1-wp_prop_poem_small-auto {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-wp_prop_poem_small-auto {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-wp_prop_poem_small-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

## *Epic. Statistical. Graphical Poems.*... are being written on the board all the time by stat's instructors.

## And isn't what's draw is the *Actual Poem*
![This isn't a pipe](https://upload.wikimedia.org/wikipedia/en/b/b9/MagrittePipe.jpg)

--

### ggplot2 *code* sometimes allows us to write those poems down in concise, consistent ways... The code is an expression of the actual poem.


---


``` r
9 * # number of layers in ma206 lesson 1 poem
  (stat_chars + layer_chars) # scaffolding code per layer
```

```
## [1] 3627
```

---






---

# New approach, w {statexpress}


``` r
library(statexpress)
```

--

### Use `statexpress::qstat` and `statexpress::qlayer` to build up poem. 

--

### Combines step 2 and 3 and requires much less code. 

--

### Delivers same user experience: computational work under the hood.


---


# Step 1. Compute



``` r
compute_panel_support &lt;- function(data, scales){
  
  data |&gt;
    summarize(xend = max(x),
              x = min(x),
              yend = 0,
              y = 0)
  
}
```

---

# Step 1.5 Sketch


``` r
donor |&gt; 
  ggplot() + 
  aes(x = decision) +
  geom_bar(width = .2) + 
  # sketching geom_support
  qlayer(geom = GeomSegment,
         stat = qstat_panel(compute_panel_support))
```

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

statexpress::qstat_panel - define panel-wise computation for a temp stat
statexpress::qlayer - use a more filled-in version of layer

---

# Step 2. User-facing function



``` r
geom_support &lt;- function(...){
  
  qlayer(stat = qstat_panel(compute_panel_support), 
         geom = GeomSegment, ...)
  
}
```

---

### Yippee - Graphical Poem!!



``` r
donor |&gt; 
  ggplot() + 
  aes(x = decision) +
  geom_bar(width = .2) + 
* geom_support()
```

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;


---

# Code burden comparison

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;


---


``` r
knitrExtra::chunk_code_get("StatSupport")
```

```
## [1] "StatSupport &lt;- ggproto(`_class` = \"StatSupport\","           
## [2] "                       `_inherit` = ggplot2::Stat,"           
## [3] "                       compute_panel = compute_panel_support,"
## [4] "                       required_aes = \"x\")"
```

---

count: false
 

.panel1-wp_prop_poem_small-auto[

```
## # A tibble: 161 × 3
##    Default Choice decision 
##    &lt;chr&gt;   &lt;chr&gt;  &lt;fct&gt;    
##  1 opt-in  donor  donor (1)
##  2 opt-in  donor  donor (1)
##  3 opt-in  donor  donor (1)
##  4 opt-in  donor  donor (1)
##  5 opt-in  donor  donor (1)
##  6 opt-in  donor  donor (1)
##  7 opt-in  donor  donor (1)
##  8 opt-in  donor  donor (1)
##  9 opt-in  donor  donor (1)
## 10 opt-in  donor  donor (1)
## # ℹ 151 more rows
```
]
 
.panel2-wp_prop_poem_small-auto[

``` r
*donor
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_02_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
* ggplot()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_03_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
* ggchalkboard::theme_chalkboard()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_04_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
* aes(x = decision)
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_05_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
* geom_stack()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_06_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
* geom_stack_label()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_07_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
* geom_support()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_08_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
  geom_support() +
* geom_prop()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_09_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
  geom_support() +
  geom_prop() +
* geom_prop_label()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_10_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
  geom_support() +
  geom_prop() +
  geom_prop_label() +
* stamp_prop()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_11_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
  geom_support() +
  geom_prop() +
  geom_prop_label() +
  stamp_prop() +
* stamp_prop_label()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_12_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
  geom_support() +
  geom_prop() +
  geom_prop_label() +
  stamp_prop() +
  stamp_prop_label() +
* geom_normal_prop_null()
```
]

---
count: false
 

.panel1-wp_prop_poem_small-auto[
![](asa-cowy-fall-2024_files/figure-html/wp_prop_poem_small_auto_13_output-1.png)&lt;!-- --&gt;
]
 
.panel2-wp_prop_poem_small-auto[

``` r
donor |&gt;
  ggplot() +
  ggchalkboard::theme_chalkboard() +
  aes(x = decision) +
  geom_stack() +
  geom_stack_label() +
  geom_support() +
  geom_prop() +
  geom_prop_label() +
  stamp_prop() +
  stamp_prop_label() +
  geom_normal_prop_null() +
* geom_normal_prop_null_sds()
```
]

&lt;style&gt;
.panel1-wp_prop_poem_small-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-wp_prop_poem_small-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-wp_prop_poem_small-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

# Part 0. Sketch epic poem on chalkboard or paper.

---

# Part 1. Sketch w qlayer and qstat


``` r
donor |&gt;
  ggplot() +
  aes(x = decision) +
  # 1. geom_stack() 
  qlayer(geom = GeomTile, stat = qstat(compute_group_bricks)) +
  # 2. geom_stack_label() 
  qlayer(geom = GeomText, stat = qstat(compute_group_count)) +
  # 3. geom_support()
  qlayer(geom = GeomSegment, stat = qstat_panel(compute_scale)) +
  # 4. geom_prop()
  qlayer(geom = GeomText, stat = qstat_panel(compute_xmean_at_y0)) + 
  # 5. geom_prop_label()
  qlayer(geom = GeomLabel, stat = qstat_panel(compute_xmean_at_y0_label))  +   
  # 6. stamp_prop()
  qlayer(geom = GeomText, stat = qstat_panel(compute_panel_prop_asserted)) +
  # 7. stamp_prop_label()
  qlayer(geom = GeomLabel, stat = qstat_panel(compute_panel_prop_asserted_label)) +
  # 8. geom_norm()
  qlayer(geom = GeomArea, stat = qstat_panel(compute_dnorm_prop)) + 
  # 9. geom_prop_norm()
  qlayer(geom = GeomSegment, stat = qstat_panel(compute_dnorm_prop_sds))
```

---

### Room for improvement...

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;


---

### Part 2. Spruce up *Geoms* w/ statexpress' `qproto_update_defaults()`, e.g. justification, linetype, color, transparency


``` r
donor |&gt;
  ggplot() +
  aes(x = decision) +
  # 1 geom_stack
  qlayer(geom = qproto_update(GeomTile, aes(color = "white")), 
         stat = qstat(compute_group_bricks)) +
  # 2 geom_stack_label() 
  qlayer(geom = qproto_update(GeomText, aes(vjust = 0)), 
         stat = qstat(compute_group_count)) +
  # 3 geom_xrange, show scale, range at y is zero
  qlayer(geom = GeomSegment, 
         stat = qstat_panel(compute_scale)) +
  ### ---
  ### ---
  ### ---
  # 8. geom_norm on prop plot
  qlayer(geom = qproto_update(GeomArea, aes(alpha = .2)),
         stat = qstat_panel(compute_dnorm_prop)) + 
   # 9. geom_prop_norm w/ sd marks
   qlayer(geom = qproto_update(GeomSegment, aes(linetype = "dotted")),
          stat = qstat_panel(compute_dnorm_prop_sds))
```



---




![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;


---

# Part 3. Write user facing functions...


``` r
geom_stack &lt;- function(...){
  
  qlayer(geom = qproto_update(GeomTile, aes(color = "white")), 
         stat = qstat(compute_group_bricks), ...)
  } 

geom_stack_label &lt;- function(...){
  
  qlayer(geom = qproto_update(GeomText, aes(vjust = 0)), 
         stat = qstat(compute_group_count), ...)
  } 

geom_support &lt;- function(...){
  
  qlayer(geom = GeomSegment, 
         stat = qstat_panel(compute_scale))
  
  }

geom_prop &lt;- function(...){
  
  qlayer(geom = qproto_update(GeomText, aes(size = 6, vjust = 1)),
         stat = qstat_panel(compute_xmean_at_y0),...)
  
  }

# etc ...
```

# Part 4. Circulate to Collegues; make adjustments

'Wow! That is great. What I like about it most is that it provides the visualization or the comparison of the statistics to the null distribution right there. I find that is the most challenging concept for cadets and it is cumbersome to either go to the applet or to draw it on the board to visualize this relationship. It disrupts the flow and their train of thought. Doing it all in one is very slick! Very easy code too!'

'I'm not a statistician, but showing a normal distribution for a binary variable for e.g. the prop test seems sketchy to me. Shouldn't it be some weird beta distribution that is bounded in [0, 1]?'



---

'There is a bunch of scaffolding code and I won't bore you with that'.

--

'There is a bunch of compute and I won't bore you with that'. 

--

You are writing the compute anyway... 

--

But, yes, it might be a little trickier in ggplot2 context...


---

*Actual* graphical-poem-first approach... 

10 or 11 new layers in my statistical poem.

400 scaffolding characters per plot element?

---




---



``` r
donor |&gt;
  ggplot() +
  aes(x = decision) +
  # 1. geom_stack() -- show counts in a count-y way (i.e. bricks!), 
  # with a good amount of space in-between stacks
  qlayer(geom = GeomTile, stat = qstat(compute_group_bricks)) +
  # 2. geom_stack_label() -- label stacks
  qlayer(geom = GeomText, stat = qstat(compute_group_count)) +
  # 3. geom_xrange, show scale, range at y is zero
  qlayer(geom = GeomSegment, stat = qstat_panel(compute_scale)) +
  # 4. geom_prop, show prop, i.e. balancing point
  qlayer(geom = GeomText,
         stat = qstat_panel(compute_xmean_at_y0)) + 
  # 5. geom_prop_label, labeling prop, balancing point
  qlayer(geom = GeomLabel,
         stat = qstat_panel(compute_xmean_at_y0_label))  +   # by 
  # 6. stamp_prop, assertion, point
  qlayer(geom = GeomText,
         stat = qstat_panel(compute_panel_prop_asserted)) +
  # 7. stamp_prop_label, assertion, label
  qlayer(geom = GeomLabel,
         stat = qstat_panel(compute_panel_prop_asserted_label)) +
  # 8. geom_norm on prop plot
  qlayer(geom = GeomArea,
         stat = qstat_panel(compute_dnorm_prop)) + 
   # 9. geom_prop_norm w/ sd marks
   qlayer(geom = GeomSegment,
          stat = qstat_panel(compute_dnorm_prop_sds)) +
   labs(title = "Is there statistical evidence that choice to between being an\nan organ donar or not differs from 50/50") 
```

![](asa-cowy-fall-2024_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;




---



``` r
donor |&gt;
  ggplot() +
  aes(x = decision) +
  geom_stack() +       # custom bar layer
  geom_stack_label() + # label stack, also see geom_stack_label_percent()
  geom_x_support() +   # line under range of x
  geom_x_prop() +      # balancing point
  geom_x_prop_label()  + # balancing point (proportion) label
  stamp_x_prop(prop = .5) + 
  stamp_x_prop_label(prop = .5)  + 
  geom_prop_null_distribution(prop = .5)
```


"get the big ideas across to the students as quickly as possible"

---

- Early exits.
- guide but don't spin off...
- 



---


'like everyone has like other life going on so figuring out how you can help those people like save time ... like maintaining
the R package is like at the top of most people's priority list or writing the best possible R code

---

Acknowledgements

- ggplot2 extenders club, esp June Choe &amp; Teun van den Brand

--

- stat_manual() group-wise computation
- stat_rasa() 




---


``` r
knitr::knit_exit()
```



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
