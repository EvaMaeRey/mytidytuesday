---
title: "another experiment"
author: "Evangeline Reynolds"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet = TRUE)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  dev = "ragg_png", # <- This piece specifically
  dpi = 400,
  fig.width = 12, fig.height = 6
)
```

ABCDEFGHIJKLMNOPQRSTVWXYZ
abcdefghijklmnopqrstuvwxyz

now I know my ABC's, what's next?

<details>

```{r}
library(statexpress)
library(tidyverse)

update_geom_defaults(GeomPoint, aes(size = from_theme(pointsize * 3)))

encode <- function(color, ...){
  aes(color = {{color}}, fill = {{color}}, ...) 
}

use <- encode


use_x <- function(x){list(aes(x = {{x}}))}
use_y <- function(y){list(aes(y = {{y}}))}




plot_data <- ggplot
use_weight <- function(weight){aes(weight = {{weight}})}
use_area <- function(area){aes(weight = {{area}})}
use_rows <- function(rows, cols, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}

use_columns <- function(cols, rows, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}
use_rows_columns <- function(rows, cols, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}
use_wrap <- function(wrap, ...){facet_wrap(facets = vars({{wrap}}), ...)}
use_size <- function(size){aes(size = {{size}})}
use_shape <- function(shape){aes(shape = {{shape}})}
use_color <- function(color){aes(fill = {{color}})}
set_color <- function(color){aes(fill = I(color))}
use_color_line <- function(color){aes(color = {{color}})}
use_chart_point <- function(...){qlayer(geom = qproto_update(GeomPoint, aes(shape = 21), 
                                                         required_aes = c()),
                                    stat = qstat(function(data, scales){data$x <- data$x %||% 0 ; data$y <- data$y %||% 0; data}), ...)}


data <- function(data){ggplot(data |> remove_missing()) + theme_classic(ink = "darkgrey", paper = "whitesmoke", base_size = 18)}
chart_jitter <- geom_jitter

chart_heat <- function(...){list(
  qlayer(geom = GeomTile, 
         stat = qproto_update(StatSum, aes(fill = after_stat(n), size = NULL)), ...),
  scale_fill_gradientn(colors = c("blue", "white", "yellow", "orange", "red")),
  theme(panel.grid.minor = element_line(color = "darkgrey")))
}



title <- function(title){labs(title = title)}
subtitle <- function(subtitle){labs(subtitle = subtitle)}
caption <- function(caption){labs(caption = caption)}
tag <- function(tag){labs(tag = tag)}



```

</details>

## pie of pets

<details>

```{r}
chart_pie <- function(...){
  
  list(
  
  geom_bar(position = "fill", ...),
  aes(y = "all", color = from_theme(paper)),
  coord_polar(),
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.line = element_blank(),
        axis.title = element_blank()),
  labs(fill = NULL)
  
  )
  
}

theme_kids <- theme_classic(paper = "whitesmoke", 
              ink = "darkgrey", 
              base_size = 30) 


theme_set(theme_kids)





pets <- data.frame(pets = c("ğŸ±", "ğŸ¶", "ğŸ¦š", "ğŸ ", "ğŸ°"), 
                   number_of_pets = c(30, 25, 10, 15, 5)) |> 
  mutate(pets = fct_infreq(pets, number_of_pets) |> fct_rev())

```

</details>

```{r}
pets

ggplot(pets) +
  use_color(pets) +
  use_area(number_of_pets) +
  chart_pie()
```



# A scatter of crustaceans

<details>


```{r crustaceans}
library(tidyverse)
types <- c("ğŸ¦", "ğŸ¦€")
crustaceans <- cars |> 
  rename(size = dist) |>
  mutate(type = c(
    rep("ğŸ¦", 20),
    sample(types, 10, replace = T),
    rep("ğŸ¦€", 20)))


GeomPointFill <-qproto_update(GeomPoint, aes(shape = 21),
                              required_aes = c())


library(statexpress)
chart_point <- function(...){
  qlayer(geom = GeomPointFill,
         stat = qstat(function(data, scales){
           data$shape <- data$shape %||% data$picture
           data$x <- data$x %||% 0 ; 
           data$y <- data$y %||% 0; 
           data}), 
         ...)
  }

use_picture <- function(picture){aes(shape = I({{picture}}))}
```

</details>


```{r}
head(crustaceans)

ggplot(crustaceans) + 
  use(y = speed, 
      x = size,
      picture = type, 
      size = size) +
  chart_point()
```

```{r}
last_plot() +
  labs(x = "little                        big") +
  labs(y = "slow           fast")
```

# A jungle bar chart... ?

<details>


```{r}
theme_chart_bar <- function(){
  theme(panel.grid.minor = element_blank(), 
        panel.grid.major.x = element_blank(),
        axis.ticks.x = element_blank())
  }

chart_bar <- function(...){
  list(geom_col(...), 
       theme_chart_bar(),
       scale_y_continuous(expand = expansion(c(0, .3))),
       labs(x = NULL))
}

compute_item_stack <- function(data, scales, width = 0.2){
               
    data$shape <- data$shape %||% data$picture

    data |> 
      uncount(y) |>
      dplyr::mutate(row = row_number()) |> 
      dplyr::mutate(y = row - 
        0.5) |>
      dplyr::mutate(width = width)
    
  }

chart_item_stack <- function(...){
  
  list(
  qlayer(
    geom = GeomPointFill, 
    stat = qstat(compute_item_stack)
  ),
  qlayer(
    geom = GeomTile, 
    stat = qstat(compute_item_stack), 
    alpha = 0
  ),
  scale_y_continuous(expand = expansion(c(0, .3))),
  labs(x = NULL)
  )

  
}

ggprop.test:::compute_group_bricks

jungle <- data.frame(tree = paste0("ğŸŒ´#", 1:5), 
                     num_bunches = c(2, 5, 1, 2, 1), 
                     banana = "ğŸŒ")

jungle |> 
  select(x = tree, y = num_bunches, picture = banana) |>
  compute_item_stack()


# last_plot() + 
#   annotate(geom = GeomText,
#            x = I(.75), y = I(.72),
#            label = "ğŸˆğŸ€ğŸ™",
#            angle = -10,
#            size = 22,
#             )  
```

</details>


```{r}
jungle

ggplot(jungle) + 
  use(x = tree,
      y = num_bunches, 
      picture = banana) + # you could also use "ğŸŒ"
  chart_item_stack()


```

```{r}


head(jungle)

ggplot(jungle) + 
  encode(x = tree,
         y = num_bunches) + 
  chart_bar()



```

# Shuttles (future work)

```{r}

shuttles <- data.frame(shuttle = paste("ğŸš€#", 1:6), gas = c(.3,.5,.3, .8,.7, .4))

ggplot(shuttles) +
  use_x(shuttle) +
  use_y(1) +
  geom_col(color = "black", fill = "transparent") + 
  geom_col(aes(y = gas), fill = "transparent", color = "black") + 
  geom_hline(yintercept = .75, linetype = "dashed")


knitr::knit_exit()

```





```{r}
data(palmerpenguins::penguins) + 
  # ggchalkboard:::theme_whiteboard() +
  use_x(island) + 
  use_y(species) +
  chart_jitter() + 
  chart_heat(alpha = .7) # does not play nice with size yet

last_plot() + 
  use_rows(sex)

data(palmerpenguins::penguins) + 
  use_x(island) + 
  use_y(species) +
  chart_jitter() +
  size(body_mass_g) + 
  guides(size = "none")

# library(ggram)
# ggram::clearhistory()
# 
# data(palmerpenguins::penguins) + 
#   viz(x = island, color = species) + 
#   layer_bar(position = "dodge2")
# 
# ggram(widths = c(2,1))



data(palmerpenguins::penguins) + 
  x(body_mass_g) + 
  y(bill_length_mm) +
  chart_point() + 
  color(species) + 
  rows(sex)
```


## ggprereader

```{r, eval = T}
`â†”` <- x
`â†•` <- y
`ğŸ¨` <- color
`ğŸ–¼` <- data
# `ğŸ“Š` <- ggpro::geom_vbar

palmerpenguins::penguins |>
`ğŸ–¼`() +
  `â†”`(species) +
  # `ğŸ“Š`() +
  `ğŸ¨`(island)
```


```{r, eval = F}
library(ggram)
ggram::clearhistory()

palmerpenguins::penguins |>
`ğŸ–¼`() +
  `â†”`(species) +
  `ğŸ“Š`() +
  `ğŸ¨`(species)

ggram(widths = c(.7,1))



```




## Closing remarks, Other Relevant Work, Caveats
