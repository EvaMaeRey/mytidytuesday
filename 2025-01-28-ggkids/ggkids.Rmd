---
title: "another experiment"
author: "Evangeline Reynolds"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet = TRUE)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  dev = "ragg_png", # <- This piece specifically
  dpi = 400,
  fig.width = 12, 
  fig.height = 6,
  warning = F,
  message = F
)
```

ABCDEFGHIJKLMNOPQRSTVWXYZ
abcdefghijklmnopqrstuvwxyz
ğŸ’ğŸ“ŠğŸš€

now I know my ABC's, what's next?

<details>

```{r}
library(statexpress)
library(tidyverse)

update_geom_defaults(GeomPoint, aes(size = from_theme(pointsize * 3)))

#' @export
aes_default <- function(default = aes(x = 0)) {

  structure(
    list(
         default_spec = default), 
    class = "aes_default"
    )

}


#' @import ggplot2
#' @importFrom ggplot2 ggplot_add
#' @export
ggplot_add.aes_default <- function(object, plot, object_name) {
  
  if(is.null(plot$mapping[[names(object$default_spec)]])){
   plot <-  plot + object$default_spec
  }

  plot

}


```



```{r}
encode <- function(color, ...){
  aes(color = {{color}}, fill = {{color}}, ...) 
}

use <- encode


use_x <- function(x){list(aes(x = {{x}}))}
use_y <- function(y){list(aes(y = {{y}}))}


plot_data <- ggplot
use_weight <- function(weight){aes(weight = {{weight}})}
use_area <- function(area){aes(weight = {{area}})}
use_rows <- function(rows, cols, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}

use_columns <- function(cols, rows, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}
use_rows_columns <- function(rows, cols, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}
use_wrap <- function(wrap, ...){facet_wrap(facets = vars({{wrap}}), ...)}
use_size <- function(size){aes(size = {{size}})}
use_shape <- function(shape){aes(shape = {{shape}})}
use_color <- function(color){aes(fill = {{color}})}
set_color <- function(color){aes(fill = I(color))}
use_color_line <- function(color){aes(color = {{color}})}
use_chart_point <- function(...){qlayer(geom = qproto_update(GeomPoint, aes(shape = 21), 
                                                         required_aes = c()),
                                    stat = qstat(function(data, scales){data$x <- data$x %||% 0 ; data$y <- data$y %||% 0; data}), ...)}


data <- function(data){ggplot(data |> remove_missing()) + theme_classic(ink = "darkgrey", paper = "whitesmoke", base_size = 18)}
chart_jitter <- geom_jitter

chart_heat <- function(...){list(
  qlayer(geom = GeomTile, 
         stat = qproto_update(StatSum, aes(fill = after_stat(n), size = NULL)), ...),
  scale_fill_gradientn(colors = c("blue", "white", "yellow", "orange", "red")),
  theme(panel.grid.minor = element_line(color = "darkgrey")))
}



title <- function(title){labs(title = title)}
subtitle <- function(subtitle){labs(subtitle = subtitle)}
caption <- function(caption){labs(caption = caption)}
tag <- function(tag){labs(tag = tag)}

stamp_picture <- function(picture = "ğŸ™‚", x = I(.5), y = I(.5), ...){
  
  annotate(geom = GeomText, label = picture, x = x, y = y, ...)
  
}

```

</details>

## pie of pets

<details>

```{r pie of pets}
chart_pie <- function(...){
  
  list(
  
  geom_bar(position = "fill", width = 1, show.legend = F, ...),
  # add defaults that bar doesn't usually include
  aes_default(aes(y = .5)), 
  aes_default(aes(fill = "All")),
  aes_default(aes(weight = 1)),
  aes_default(aes(color = from_theme(paper))),
  # add labels
  stat_count(geom = GeomLabel, color = "transparent",
             position = position_fill(vjust = .5),
             aes(label = after_stat(fill), 
                 y = .9, 
                 # group = after_stat(fill)
                 ), alpha = 0,
             show.legend = F,
             size = 30
             ),
  coord_polar(),
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.line = element_blank(),
        axis.title = element_blank()),
  labs(fill = NULL)
  
  )
  
}

theme_kids <- theme_classic(paper = "whitesmoke", 
              ink = "darkgrey", 
              base_size = 30,
              base_family = "Comic Sans MS") 

theme_set(theme_kids)




pets_data <- data.frame(pets = c("ğŸ±", "ğŸ¶", "ğŸ¦š", "ğŸ ", "ğŸ°"), 
                   number_of_pets = c(30, 25, 10, 15, 5)) |> 
  mutate(pets = fct_infreq(pets, number_of_pets) |> fct_rev())



```

</details>

```{r}
pets_data

ggplot(pets_data) +
  chart_pie() + 
  use_color(pets) + 
  use_area(number_of_pets)
```



# A scatter of crustaceans

<details>


```{r crustaceans}
library(tidyverse)
types <- c("ğŸ¦", "ğŸ¦€")
set.seed(1234)
ocean_table <- cars |> 
  rename(size = dist) |>
  mutate(type = c(
    rep("ğŸ¦", 20),
    sample(types, 10, replace = T),
    rep("ğŸ¦€", 20))) |>
  sample_frac()


GeomPointFill <-qproto_update(GeomPoint, aes(shape = 21),
                              required_aes = c())


library(statexpress)
chart_point <- function(...){
  list(
  qlayer(geom = GeomPointFill,
         stat = qstat(function(data, scales){
           # data$shape <- data$shape %||% data$picture
           # data$x <- data$x %||% 0 ; 
           # data$y <- data$y %||% 0; 
           data}), 
         ..., show.legend = F),
  aes_default(aes(x = 0)),
  aes_default(aes(y = 0)),
  aes_default(aes(shape = I(after_stat(picture)))),
  scale_size(range = c(2,10))
  
  )
  }


# should replace with lm xy
chart_fit_line <- function(...){
  
  geom_smooth(method = lm, ..., show.legend = F, se = F, 
              linetype = "dashed",
              aes(shape = NULL, picture = NULL))
  
}

use_picture <- function(picture){aes(shape = I({{picture}}))}
```

</details>


```{r}
head(ocean_table)

ggplot(ocean_table) + 
  chart_point() +
  use_y(speed) +
  use_x(size) + 
  use_size(size) + 
  use_picture(type) + 
  chart_fit_line()
```

```{r}
last_plot() +
  labs(x = "little                        big") +
  labs(y = "slow           fast") +
  theme(panel.background = element_rect(fill = "skyblue")) + 
  stamp_picture("ğŸ‰", 
                size = 40, 
                x = 100,
                y = 10)
```

# A jungle bar chart... ?

<details>


```{r jungle_table}
theme_chart_bar <- function(){
  theme(panel.grid.minor = element_blank(), 
        panel.grid.major.x = element_blank(),
        axis.ticks.x = element_blank())
  }

chart_bar <- function(...){
  list(geom_col(...), 
       theme_chart_bar(),
       scale_y_continuous(expand = expansion(c(0, .3))),
       labs(x = NULL))
}

compute_item_stack <- function(data, scales, width = 0.2){
               
    data$shape <- data$shape %||% data$picture

    data |> 
      uncount(y) |>
      dplyr::mutate(row = row_number()) |> 
      dplyr::mutate(y = row - 
        0.5) |>
      dplyr::mutate(width = width)
    
  }

chart_item_stack <- function(...){
  
  list(
  qlayer(
    geom = GeomPointFill, 
    stat = qstat(compute_item_stack)
  ),
  qlayer(
    geom = GeomTile, 
    stat = qstat(compute_item_stack), 
    alpha = 0
  ),
  scale_y_continuous(expand = expansion(c(0, .3))),
  aes_default(aes(y = 1)),
  aes_default(aes(x = "All")),
  labs(x = NULL)
  )

  
}

ggprop.test:::compute_group_bricks

jungle_table <- data.frame(tree = paste0("ğŸŒ´#", 1:5), 
                     num_bunches = c(2, 5, 1, 2, 1), 
                     banana = "ğŸŒ")

jungle_table |> 
  select(x = tree, y = num_bunches, picture = banana) |>
  compute_item_stack()




# last_plot() + 
#   annotate(geom = GeomText,
#            x = I(.75), y = I(.72),
#            label = "ğŸˆğŸ€ğŸ™",
#            angle = -10,
#            size = 22,
#             )  
```

</details>


```{r}
jungle_table

ggplot(jungle_table) + 
  chart_item_stack() +
  use(x = tree,
      y = num_bunches, 
      picture = banana) + # you could also use "ğŸŒ"
  chart_item_stack()


last_plot() + 
  stamp_picture("ğŸ’",
                size = 40,
                x = I(.95),
                y = I(.15)) + 
  coord_cartesian(clip = "off")

```

```{r}


head(jungle_table)

ggplot(jungle_table) + 
  encode(x = tree,
         y = num_bunches) + 
  chart_bar(fill = "gold")



```

# Polar Bears


```{r}

chart_bar_plunging <- function(...){
  list(geom_col(...), 
       theme_chart_bar(),
       scale_y_reverse(expand = expansion(c(.3, 0))),
       scale_x_discrete(position = "top"),
       labs(x = NULL),
       geom_label(vjust = 1, aes(label = after_stat(y))))
}

bears <- paste0("ğŸ»â€â„ï¸ #", 1:5)
depth <- c(3,5,4,6,5)

polar_bear_table <- data_frame(bears, depth)

ggplot(polar_bear_table) +
  use_x(bears) + 
  use_y(depth) +
  chart_bar_plunging(fill = "skyblue")

```

# digging


```{r}
time <- paste0(c(0, 15, 30, 45, 60), "â±ï¸")
num_tunnels <- c(0, 4, 5, 5.5, 5.9)
fork_and_spoon_table <- data_frame(time, num_tunnels, type = "ğŸ´")

shovel_and_bucket_table <- data_frame(time, num_tunnels = num_tunnels * 2, type = "ğŸª£")

paws_table <- data_frame(time, num_tunnels = num_tunnels * 3, type = "ğŸ¾")



fork_and_spoon_table |>
  bind_rows(shovel_and_bucket_table) |>
  bind_rows(paws_table) |>
ggplot() +
  use_x(time) + 
  use_y(num_tunnels) + 
  use(picture = type) +
  geom_line(aes(group = type)) +
  chart_point()


```


# Shuttles (future work)

<details>

```{r}

outer_space_data <- data.frame(shuttle = paste0("ğŸš€ #", 1:6), fuel = c(.3,.5,.3, .8,.7, .4))

chart_part_of_full <- function(...){
  
  list(
       geom_col(color = "black", fill = "transparent", aes(y = 1)),
       geom_col(color = "black", ... )
       )
  
}

stamp_hline <- function(y = .5, linetype = "dashed", ...){
  
  geom_hline(yintercept = y, linetype = linetype, ...)
  
}
```

</details>

```{r}
outer_space_data

ggplot(outer_space_data) +
  use(x = shuttle,
      y = fuel) +
  chart_part_of_full(fill = "darkolivegreen3") +
  stamp_hline(.75)


last_plot() + 
  stamp_picture("ğŸ‘½",
                angle = 25,
                size = 40,
                x = I(.95),
                y = I(.15)) + 
  coord_cartesian(clip = "off")


knitr::knit_exit()

```





```{r}
data(palmerpenguins::penguins) + 
  # ggchalkboard:::theme_whiteboard() +
  use_x(island) + 
  use_y(species) +
  chart_jitter() + 
  chart_heat(alpha = .7) # does not play nice with size yet

last_plot() + 
  use_rows(sex)

data(palmerpenguins::penguins) + 
  use_x(island) + 
  use_y(species) +
  chart_jitter() +
  size(body_mass_g) + 
  guides(size = "none")

# library(ggram)
# ggram::clearhistory()
# 
# data(palmerpenguins::penguins) + 
#   viz(x = island, color = species) + 
#   layer_bar(position = "dodge2")
# 
# ggram(widths = c(2,1))



data(palmerpenguins::penguins) + 
  x(body_mass_g) + 
  y(bill_length_mm) +
  chart_point() + 
  color(species) + 
  rows(sex)
```


## ggprereader

```{r, eval = T}
`â†”` <- x
`â†•` <- y
`ğŸ¨` <- color
`ğŸ–¼` <- data
# `ğŸ“Š` <- ggpro::geom_vbar

palmerpenguins::penguins |>
`ğŸ–¼`() +
  `â†”`(species) +
  # `ğŸ“Š`() +
  `ğŸ¨`(island)
```


```{r, eval = F}
library(ggram)
ggram::clearhistory()

palmerpenguins::penguins |>
`ğŸ–¼`() +
  `â†”`(species) +
  `ğŸ“Š`() +
  `ğŸ¨`(species)

ggram(widths = c(.7,1))



```




## Closing remarks, Other Relevant Work, Caveats
