---
title: "another experiment"
author: "Evangeline Reynolds"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet = TRUE)
```




## Intro Thoughts




## Status Quo

```{r}
library(statexpress)
library(tidyverse)
x <- function(x){list(aes(x = {{x}}))}
y <- function(y){list(aes(y = {{y}}))}
plot <- ggplot
encode <- aes
weight <- function(weight){aes(weight = {{weight}})}
area <- function(area){aes(weight = {{area}})}
rows <- function(rows, cols, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}

columns <- function(cols, rows, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}
rows_columns <- function(rows, cols, ...){facet_grid(rows = vars({{rows}}), cols = vars({{cols}}), ...)}
wrap <- function(wrap, ...){facet_wrap(facets = vars({{wrap}}), ...)}
size <- function(size){aes(size = {{size}})}
color <- function(color){aes(fill = {{color}})}
set_color <- function(color){aes(fill = I(color))}
color_line <- function(color){aes(color = {{color}})}
mark_point <- function(...){qlayer(geom = qproto_update(GeomPoint, aes(shape = 21), 
                                                         required_aes = c()),
                                    stat = qstat(function(data, scales){data$x <- data$x %||% 0 ; data$y <- data$y %||% 0; data}), ...)}

theme_chart_bar <- function(){theme(panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(),
                                    axis.ticks.x = element_blank())}

mark_bar <- function(...){list(geom_bar(...), theme_chart_bar(), scale_y_continuous(expand = c(0, .3)))}
data <- function(data){ggplot(data |> remove_missing()) + ggchalkboard:::theme_whiteboard()}
mark_jitter <- geom_jitter

mark_heat <- function(...){list(
  qlayer(geom = GeomTile, 
         stat = qproto_update(StatSum, aes(fill = after_stat(n), size = NULL)), ...),
  scale_fill_gradientn(colors = c("blue", "white", "yellow", "orange", "red")),
  theme(panel.grid.minor = element_line(color = "darkgrey")))
}

viz <- function(color, ...){
  aes(color = {{color}}, fill = {{color}}, ...) 
}

map <- viz


title <- function(title){labs(title = title)}
subtitle <- function(subtitle){labs(subtitle = subtitle)}
caption <- function(caption){labs(caption = caption)}
tag <- function(tag){labs(tag = tag)}


mark_pie <- function(...){list(
  
  geom_bar(position = "fill", ...),
  aes(y = "all"),
  coord_polar(),
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.line = element_blank(),
        axis.title = element_blank())
  
)
  
}

pets <- data.frame(pets = c("cats", "dogs", "peacocks", "fish", "bunnies"), frequency = c(30, 25, 10, 15, 5))


data(pets) + 
  encode(color = pets,
         area = frequency) +
  mark_pie() 

last_plot() + 
  color_line(pets) + 
  set_color("white")


jungle <- data.frame(tree = paste("tree", 1:5), bunches = c(2, 5, 1, 2, 1))
shuttles <- data.frame(shuttle = paste("shuttle", 1:6), gas = c(.3,.5,.3, .8,.7, .4))

data(shuttles) +
  x(shuttle) +
  y(1) +
  geom_col(color = "black", fill = "transparent") + 
  geom_col(aes(y = gas), fill = "transparent", color = "black") + 
  geom_hline(yintercept = .75, linetype = "dashed")

```




```{r}
library(tidyverse)
types <- c("ğŸ¦", "ğŸ¦€")
crustacians <- cars |> 
  rename(size = dist) |>
  mutate(type = c(
    rep("ğŸ¦", 20),
    sample(types, 10, replace = T),
    rep("ğŸ¦€", 20)))

mark_picture <- geom_text
picture <- function(picture){aes(label = {{picture}})}

plot(crustacians) + 
  x(size) + 
  y(speed) +
  picture(type) +
  mark_picture() 

last_plot() + 
  y(speed) + 
  geom_smooth(fill = "black")
```



```{r}
data(jungle |> uncount(bunches)) + 
  x(tree) + 
  mark_bar(aes(color = from_theme(ink)), fill = "transparent")


data(palmerpenguins::penguins) + 
  # ggchalkboard:::theme_whiteboard() +
  x(island) + 
  y(species) +
  mark_jitter() + 
  mark_heat(alpha = .7) # does not play nice with size yet

last_plot() + 
  rows(sex)

data(palmerpenguins::penguins) + 
  x(island) + 
  y(species) +
  mark_jitter() +
  size(body_mass_g) + 
  guides(size = "none")

# library(ggram)
# ggram::clearhistory()
# 
# data(palmerpenguins::penguins) + 
#   viz(x = island, color = species) + 
#   layer_bar(position = "dodge2")
# 
# ggram(widths = c(2,1))



data(palmerpenguins::penguins) + 
  x(body_mass_g) + 
  y(bill_length_mm) +
  mark_point() + 
  color(species) + 
  rows(sex)
```


## ggprereader

```{r, eval = T}
`â†”` <- x
`â†•` <- y
`ğŸ¨` <- color
`ğŸ–¼` <- data
`ğŸ“Š` <- ggpro::geom_vbar

palmerpenguins::penguins |>
`ğŸ–¼`() +
  `â†”`(species) +
  `ğŸ“Š`() +
  `ğŸ¨`(island)
```


```{r, eval = F}
library(ggram)
ggram::clearhistory()

palmerpenguins::penguins |>
`ğŸ–¼`() +
  `â†”`(species) +
  `ğŸ“Š`() +
  `ğŸ¨`(species)

ggram(widths = c(.7,1))



```




## Closing remarks, Other Relevant Work, Caveats
