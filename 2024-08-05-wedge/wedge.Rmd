---
title: "another experiment"
author: "Evangeline Reynolds"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet = TRUE)
```




## Intro Thoughts


## Status Quo

```{r}
library(tidyverse)

compute_panel_wedge <- function(data, scales, vertices = 5){
  
  data |>
    mutate(prop = area/sum(area)) |>
    mutate(cumprop = cumsum(prop))->
  props_vertices; props_vertices
  
  props_vertices %>% 
    mutate(lagcumprop = lag(cumprop, default = 0)) %>% 
    mutate(x = cos(cumprop*2*pi)) %>% 
    mutate(y = sin(cumprop*2*pi)) ->
  props_vertices; props_vertices
  
  data.frame(around = 0:vertices/vertices) %>%
    crossing(props_vertices) %>%
    group_by(id) %>%
    filter(lagcumprop <= around &
           cumprop >= around) %>%
    mutate(x = cos(around*2*pi)) %>%
    mutate(y = sin(around*2*pi)) %>% 
    ungroup() ->
  arcs; arcs

  props_vertices %>% 
    mutate(around = cumprop) %>% 
    full_join(arcs) %>% 
    arrange(id, around) %>% 
    distinct() ->
  circle_points; circle_points
  
  data |>
    distinct(id, area) |>
    mutate(x = 0) |>
    mutate(y = 0) %>%
    mutate(around = 0) %>%
    mutate(cumprop = 0) %>%
    mutate(prop = 0) ->
  middle; middle

  data |>
    distinct(id, area) |>
    mutate(x = 0) |>
    mutate(y = 0) %>%
    mutate(around = 1) %>%
    mutate(cumprop = 1) %>%
    mutate(prop = 1) ->
  middle2; middle2

  full_join(middle, circle_points) %>% 
    full_join(middle2)

  }


diamonds %>% 
  count(cut) %>% 
  select(id = cut, area = n) %>% 
  compute_panel_wedge() %>% 
  data.frame()


diamonds %>% 
  count(cut) %>% 
  select(id = cut, area = n) %>% 
  compute_panel_wedge() %>% 
  ggplot() + 
  aes(x = x, y = y, color = id) + 
  geom_point() + 
  geom_path() + 
  coord_equal()


StatWedge <- ggproto("StatWedge",
                     Stat,
                     compute_panel = 
                       compute_panel_wedge)



```


```{r, eval = T, error=T}
diamonds |>
  count(cut) |>
  ggplot() + 
  aes(id = cut, area = n) + 
  geom_point(stat = StatWedge) + 
  aes(color = after_stat(id)) +
  aes(fill = after_stat(id)) +
  geom_polygon(stat = StatWedge) +
  coord_equal()

# diamonds |> 
#   ggplot() + 
#   aes(fill = cut, x = "all") + 
#   geom_bar()


```

## Experiment

```{r}

```



## Closing remarks, Other Relevant Work, Caveats
