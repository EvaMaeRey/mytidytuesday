---
title: "edgelist2ggraph sketch"
author: "Evangeline Reynolds"
date: "9/20/2023"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## {edgelist2ggraph} idea

Here we think about a shortcut to a first looks at networks using a flat, edgelist input that leads straight to a ggplot2 plot (ggraph) space; this will uses tidygraph and ggraph under the hood...



## Before getting into it, create an 'interesting' edge list

```{r cars, message=F, warning=F}
library(tidyverse)
library(tidygraph)
library(ggraph)

set.seed(12345)
edge_list <- data_frame(node_to = sample(rep(LETTERS[1:10], 50), replace = T), node_from = sample(rep(LETTERS[1:10], 50), replace = T)) %>% 
  arrange(node_to, node_from) %>% 
  count(node_to, node_from) %>% 
  sample_n(18)


head(edge_list)
```

## The status quo

```{r}
edge_list %>% 
  as_tbl_graph() %>% 
  ggraph() +
  geom_edge_link(color = "orange") +
  geom_node_point(size = 9,
                  color = "steelblue",
                  alpha = .8) + 
  geom_node_text(aes(label = name))


# aesthetic mapping for edge characteristics
last_plot() + 
  geom_edge_link(color = "red", 
                 alpha = .5 ,
                 aes(edge_width = n))
```


# proposed rearrangement


```{r}
qedgelist2ggraph <- function(edgelist, ...){
  
  edgelist %>% 
  as_tbl_graph() %>% 
  ggraph(...) +
  geom_edge_link(color = "orange") +
  geom_node_point(size = 9,
                  color = "steelblue",
                  alpha = .8) + 
  geom_node_text(aes(label = name))
  
  
  
}



# convenience function for labeled nodes.  
edgelist2ggraph <- function(edgelist, ...)(
  
  # message("'name' a variable created in the 'nodes' dataframe")
  
  edgelist %>% 
  as_tbl_graph() %>% 
  ggraph(...) 
  
)



geom_node_label_name <- function(...){ 
  
  geom_node_label(aes(label = name), ...)
  
}

geom_node_text_name <- function(...){ 
  
  geom_node_text(aes(label = name), ...)
  
}


```


# examples w/ proposed functions

```{r}
edge_list %>% 
  qedgelist2ggraph() 

edge_list %>% 
  edgelist2ggraph(layout = "kk") + 
  geom_edge_link(arrow = arrow(angle = 25, 
                               length = unit(.2, "cm"))) + 
  geom_node_tile(width = 1, height = 1) + 
  geom_node_text_name() 

```


# ggflowchart example (100% inspiration)

```{r}
# flowcharter example
ggflowchart_example <- tribble(~from, ~to,
        "A", "B",
        "A", "C",
        "A", "D",
        "B", "E",
        "C", "F",
        "F", "G") 
```


## Start by using quick plot function 'qedgelist2ggraph'

```{r, fig.show='hold'}
ggflowchart_example %>% 
  qedgelist2ggraph(layout = "stress")

ggflowchart_example %>% 
  qedgelist2ggraph(layout = "tree")

ggflowchart_example %>% 
  qedgelist2ggraph(layout = "auto")

layer_data(last_plot(), i = 2)
```

## Use edgelist2ggraph and geom_edge_* and geom_node_* functions to customize

```{r}
ggflowchart_example %>% 
  edgelist2ggraph() +
  geom_edge_link(linetype = "dashed") + 
  geom_node_point(size = 12, alpha = .2) + 
  geom_node_label_name(fill = "magenta")

```

## if necessary, use tidygraph to perform more calculations/joins

## use flowcharter to make it even faster and very pretty.

allows for node info, which currently isn't in proposal...

```{r}
library(ggflowchart)
node_data <- tibble::tibble(
  name = c("A", "B", "C", "D", "E", "F", "G"),
  type = c("Type 1", "Type 1", "Type 1", "Type 1", 
           "Type 2", "Type 2", "Type 2")
  )
ggflowchart(ggflowchart_example, 
            node_data, fill = type)

```

