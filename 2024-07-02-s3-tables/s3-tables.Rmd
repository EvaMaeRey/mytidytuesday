---
title: "another experiment"
author: "Evangeline Reynolds"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet = TRUE)
```




## Intro Thoughts


## Status Quo

```{r}
library(tidyverse)
create_tidypivot <- function(data = data.frame(), rows = NULL, columns = NULL, value = NULL, weight = NULL) {
  
  # Create a list with specified components
  obj <- list(
    data = data,
    rows = rows,
    columns = columns,
    value = value,
    weight = weight
  )
  
  # Set the class attribute to indicate this is of class 'tidypivot'
  class(obj) <- "tidypivot"
  
  # Return the created object
  invisible(obj)
  
}


print_specified_table = function(tp){

      out <- 'tidypivot::pivot_helper(thedata, rows, cols, value, wt, fun)'

  
      str_replace_or_null <- function(x, pattern, replacement){
        
        if(is.null(replacement)){x |> str_replace(pattern, 'NULL')}
        else{x |> str_replace(pattern, replacement)}
        
      }
      
      # out <- str_replace_or_null(out, "data",  tp$data)
      out <- str_replace_or_null(out, "rows",  tp$rows)
      out <- str_replace_or_null(out, "cols",  tp$cols)
      out <- str_replace_or_null(out, "fun",   tp$fun)
      out <- str_replace_or_null(out, "value", tp$value)
      out <- str_replace_or_null(out, "wt",    tp$wt)
      out <- str_replace_or_null(out, "fun",    tp$fun)

      eval(parse(text = out))         
      
            
}



# Define a print method for 'tidypivot'
  print.tidypivot <- function(tp, print_flag = TRUE) {
    if (print_flag) {
      # print(print_specified_table(tp))
      print("An new table or update to specification just happened")
    # cat("----------------------\nTable specification:\n")
    # cat("Data:", x$data, "\n")
    # # print(x$data)
    # cat("Rows:", x$rows, "\n")
    # cat("Columns:", x$cols, "\n")
    # cat("Function:", x$fun, "\n")
    # cat("Value:", x$value, "\n")
    # cat("Weight:", x$weight, "\n")
    }
  }
  
ggtable <- function(data){
  
  thedata <<- data

tp <- create_tidypivot(deparse(substitute(thedata)))
    
  tp |>
  print.tidypivot()
  
  invisible(tp)
  
    last_tp <<- tp

}

set_rows <- function(tp, rows = NULL){
  
tp$rows <- deparse(substitute(rows))

  tp |>
  print.tidypivot()
  
  invisible(tp)
  
    last_tp <<- tp

}

set_cols <- function(tp, cols = NULL){
  
tp$cols <- deparse(substitute(cols))

  tp |>
  print.tidypivot()
  
  invisible(tp)
  
    last_tp <<- tp
}


set_fun <- function(tp, fun = sum){

tp$fun <- deparse(substitute(fun))


  tp |>
  print.tidypivot()

  invisible(tp)

    last_tp <<- tp

  
}

set_value <- function(tp, value = NULL){
  
tp$value <- deparse(substitute(value))

  tp |>
  print.tidypivot()
  
  invisible(tp)
  
  last_tp <<- tp
  
}

set_weight <- function(tp, weight = NULL){
  
tp$weight <- deparse(substitute(weight))

  tp |>
  print.tidypivot()
  
  invisible(tp)
  
  last_tp <<- tp
  
}




ggtable(cars) |> str()
  



last_table <- function(){
  
  last_tp
  
}


Titanic |> 
  data.frame() |>
  uncount(Freq) |> 
  ggtable() |> 
  set_rows(Survived) |> 
  print_specified_table()

last_table() |> 
  set_cols(c(Sex, Class)) |>
  print_specified_table() 

ggtable(mtcars) |> 
  set_rows(cyl) |> 
  set_cols(am) |>
  set_cols(c(gear, am)) |> 
  set_fun(sum) |>
  set_value(mpg) |>
  set_weight(cyl) |>
  print_specified_table() 

ggtable(mpg) |> 
  set_rows(class) |>
  print_specified_table()



```


```{r}
knitr::knit_exit()

```
