---
title: "another experiment"
author: "Evangeline Reynolds"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tidyverse.quiet = TRUE)
```




## Intro Thoughts


## Status Quo

```{r}
library(tidyverse)
library(tidygraph)
library(ggraph)

set.seed(9876)
as_tbl_graph(highschool) %>%
  activate("edges") %>% 
  tidygraph::as_tibble() %>% 
  filter(year == 1957) ->
edgelist  


edgelist %>% # edgelist
  tidygraph::as_tbl_graph() %>% 
  create_layout(layout = "stress") ->
node_layout


edgelist %>% 
  left_join(node_layout %>% 
              select(from = .ggraph.orig_index, 
                     x, y)) %>% 
  left_join(node_layout %>% 
              select(to = .ggraph.orig_index,
                     xend = x,
                     yend = y)) %>% 
  ggplot() + 
  aes(x = x, y = y) + 
  geom_point() + 
  aes(xend = xend, yend = yend) +
  geom_segment()

layer_data()  %>% tibble()  
```



```{r, eval = T}
compute_panel_edgelist_nodes <- function(data, scales, layout = "stress"){
  
data %>% # edgelist
  select(from, to, everything()) %>% 
  tidygraph::as_tbl_graph() ->
graph    
    
graph %>% 
  ggraph::create_layout(layout = layout) ->
node_layout


node_layout

# graph %>% 
#   activate("nodes") %>% 
#   as_tibble() %>% 
#   left_join()
  
}


StatEdgelistNodes <- ggproto("StatEdgelistNodes", 
                        Stat,
                        compute_panel = compute_panel_edgelist_nodes,
                        required_aes = c("from", "to"))


edgelist %>% 
  ggplot() + 
  aes(from = from, to = to) + 
  geom_point(stat = StatEdgelistNodes)


compute_panel_edgelist_edges <- function(data = edgelist, scales, layout = "stress"){
  
  
data %>% # edgelist
  select(from, to, everything()) %>% 
  tidygraph::as_tbl_graph() %>% 
  ggraph::create_layout(layout = layout) ->
node_layout
  
data %>% 
  select(from, to, everything()) %>% 
  tidygraph::as_tbl_graph() %>% 
  activate("edges") %>% 
  as_tibble() %>% 
  left_join(node_layout %>% 
              select(from = .ggraph.orig_index, 
                     x, y)) %>% 
  left_join(node_layout %>% 
              select(to = .ggraph.orig_index,
                     xend = x,
                     yend = y)) 
  
}

edgelist %>% 
  compute_panel_edgelist_edges()

StatEdgelistEdges <- ggproto("StatEdgelistEdges", 
                        Stat,
                        compute_panel = compute_panel_edgelist_edges,
                        required_aes = c("from", "to"))



last_plot() + 
  geom_segment(stat = StatEdgelistEdges) #uh oh!

layer_data(i = 2) %>% head()

```



```{r, eval = F}
cran_20230905 <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-09-19/cran_20230905.csv')
package_authors <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-09-19/package_authors.csv')


cran_20230905 %>%
  filter(Package %>%
           str_detect("^gg|^GG")) %>%
  filter(Imports %>%
           str_detect("ggplot2")|
         Depends %>% str_detect("ggplot2")) %>%
  select(Package) %>%
  left_join(package_authors %>%
              mutate(authorsR = authorsR %>%
                       str_replace(" ", "\n"))) %>% 
  ggplot() + 
  aes(from = Package, to = authorsR) + 
  geom_point(stat = StatEdgelistNodes) + 
  geom_poin
  




```


```{r}
set.seed(9876)
as_tbl_graph(highschool) %>% 
  activate("edges") %>% 
  filter(year == 1957) %>% 
  ggraph() + 
  geom_node_point() + 
  geom_edge_link()

layer_data(i = 2) %>% tibble()

# ggraph
# 
# layer_data(i = 2) %>% head()
# 
# geom_edge_link

```

## Experiment

```{r}

```



## Closing remarks, Other Relevant Work, Caveats
